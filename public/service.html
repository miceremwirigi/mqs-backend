<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/style.css">
    <script src="/script.js"></script>
    <title>MQS</title>
</head>
<body>
    <div class="header">
        <h1 class="title">MQS Inc.</h1>
        <h2 class="subtitle">Medical Service Service Sheduling</h2>
    </div>
    </div class="content"> 

        <div id="success-popup">Success</div>
        <div id="failed-popup">Failed</div>

        <h3 style="color: black;">Service Date: {{.name}}</h3>
        <h3 style="color: black;">Equipments: {{.equipments}}</h3>
        <h3 style="color: black;">Engineers: {{.engineers}}</h3>

        <form id="update-service-form" class="add-content-form">
            <h3>Add New Service</h3>
            <label for="service-date">Service Date</label>
            <input type="date" id="service-date" name="date" value="{{.date}}" required>
            <br>
            <label for="serviced-equipments">Equipments</label>
            <input type="text" id="service-equipments" name="serviced-equipments" value="{{.equipments}}" required>
            <br>
            <label for="serviced-engineers">Serviced By</label>
            <input type="text" id="service-engineers" name="serviced-engineers" value="{{.engineers}}" required>
            <br>
            <button type="submit" onclick="handleUpdateFormSubmit()">Update Service</button>
        </form>

        <span>
            <button onclick="document.location='../../../index.html'">Back</button>
            <button onclick="toggleFormVisibility(`update-service-form`)">Edit</button>
            <button onclick="deleteService()">Delete</button>
        </span>

        <script>
            const form = document.getElementById("update-service-form");
            form.addEventListener( 'submit', async (event) => {
                    event.preventDefault();
                })

            deleteServiceUrl = "/api/services/delete/{{.id}}";
            function deleteService() {
                fetch(deleteServiceUrl,{
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => {
                    if (!response.ok){
                    throw new Error(`HTTP Error: Status ${response.status}`);
                }
                    return response.json();
                })
                .then(data => {
                    
                    showSuccessMessage();
                    window.location.href = "/index.html";
                })
                .catch(error => {
                    console.Error("error fetching services");
                    showFailedMessage();
                })
            }

            async function handleUpdateFormSubmit() {
                const form = document.getElementById("update-service-form");                
                const formData = new FormData(form);

                const jsonObject = Object.fromEntries(formData.entries())

                const jsonString = JSON.stringify(jsonObject);
                console.log(`form data ${jsonString}`);

                await fetch ("/api/services/{{.id}}",{
                    method: "PUT",
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: jsonString,
                })
                .then(response => {
                    console.log(response)
                    if (!response.ok) {
                        throw new Error(`HTTP Error: Status ${response.status}`);
                    }
                    return response.json();
                })
                .then( body => {
                    showSuccessMessage();
                })
                .catch( error => {
                    console.error(`"error updating service: ${error}`);
                    showFailedMessage();
                })
                // window.location.href = "/api/services/details/{{.id}}";
                hideInputForms();
            }

            function showSuccessMessage() {
                const popup = document.getElementById('success-popup');
                popup.style.display = 'block';
                setTimeout(function() {
                    popup.style.display = 'none';
                }, 3000); // Message disappears after 3 seconds (3000 milliseconds)
            }

            function showFailedMessage() {
                const popup = document.getElementById('failed-popup');
                popup.style.display = 'block';
                setTimeout(function() {
                    popup.style.display = 'none';
                }, 3000); // Message disappears after 3 seconds (3000 milliseconds)
            }
        </script>
          
        <p>For more information, please refer to the documentation.</p>
        <p>Version: 1.0.0</p>
    </div>

    <div class="footer">
        <p>&copy; 2025 MQS. All rights reserved.</p>
    </div>
</body>
</html>